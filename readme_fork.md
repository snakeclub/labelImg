# LabelImg分支修改说明

## 新增功能点

1、支持删除当前图片文件，通过键盘 Del 按键进行删除；

2、支持显示及修改当前图片的信息文件，加载图片时自动加载对应的信息文件，并显示在界面中；

3、支持通过TF1.x版本的 Object Detect Api 冻结模型进行自动标注处理，辅助人工提升标注效率；

4、菜单 “Extend -> 处理图片” 增加对训练图片兼容性支持处理，包括：删除位深不为RGB三通道的图片（TF对图片数据存在要求）、统一转换图片格式为jpg、检查标注xml文件的文件名和路径是否正确；

5、菜单 “Extend -> 批量重命名” 支持对图片文件进行重命名处理；

6、菜单 “Extend -> 按标注截图” 支持按标注区域进行截图，生成新的只有标注区域内容的图片；

7、菜单 “Extend -> 按标注复制文件” 支持按特定标注，将具备该标注的图片复制到指定目录；

8、菜单 “Extend -> 标注统计” 支持统计标注的数量；

9、菜单 “Extend -> 生成labelmap.pbtxt文件” 支持生成训练所需的 pbtxt 格式文件；

10、菜单 “Extend -> LabelImg生成TFRecord” 支持生成训练所需的 TFRecord 文件；



## 新增功能点具体使用说明

### 分类信息配置

需配置  "./data/mapping.json" 文件定义分类信息和显示名的映射关系，具体参数说明如下：

- defalut_class - 进行标注时的默认分类名，便于快速操作
- set_by_info - 通过图片信息文件中的属性值设置新的标注名（进行统计或生成训练文件时使用）
  - class_name - 需要设置的原标注名（比如统一标注为翡翠）
  - info_tag - 在信息文件中的属性名（比如设置为“款式”，则会从信息文件中找到“款式”的属性值作为标注名处理）

- info_key_dict - 要展示信息的字典模板（控制要显示的信息字段）
- enable_mapping - 定义当前使用的映射类型名，在配置文件中可以配置多个映射类型

在配置文件中，非以上定义的字典值均为分类映射配置，key为映射类型名，value为映射配置字典，定义如下：

- class - 分类映射字典，key为显示名（中文名），value为实际分类值（英文名）
- class_int - 分类显示名（中文名）与分类标签（整数）的映射关系，用于生成TFRecord文件使用，注意不在该字典中的分类标注，将不会生成TFRecord文件
- unknow_to_other - true/false, 是否将class_int不存在的标签转换为class中的"other"英文名对应的标签
- ignore_inner - 忽略标注范围内（完全包含）的其他标注配置字典，key为外部标注英文，value为要忽略的方式：
        all - 忽略所有
        other - 仅忽略other标签



### 显示及修改图片信息文件

1、信息文件必须与图片在同一个目录下，如果是当前图片独有的信息文件，文件命名为 “图片文件名.info”；也可以对当前目录下所有图片公用一个信息文件，文件命名为 "info.json";

2、信息文件为 json 格式的字典内容，字典 key 为属性名，value 为属性值，文件编码必须为 utf-8 ，内容示例如下：

```
{
	"商品名称": "电脑",
	"价格": "6.00",
	...
}
```

3、需修改 "./data/mapping.json" 映射配置字典，将 “info_key_dict” 字典修改为要显示的属性名，只有在这个字典中的属性才会显示出来：

```
{
	...
	"info_key_dict": {
		"商品名称": "",
		"价格": "",
		...
	},
	...
}
```



### 自动标注功能

1、通过 "./data/tf_auto_label.json"  配置文件进行自动标注配置，可以同时配置多个自动标注模型，示例如下：

```
{
	"a_type": {
        "enable": true,
        "frozen_graph": "/a_type/frozen_inference_graph.pb",
        "min_score": 0.5,
        "min_distance": 0.05
    },
    ...
}
```

- 
  enable - 是否启动自动标注功能
- frozen_graph - 冻结模型pb文件路径（仅测试ssd_mobilenet_v2，其他模型未适配）
- min_score - 显示最低分数，匹配度低于该分数的情况不显示标注；
- min_distance - 判断标注相近的最小距离(图片百分比)，如果自动标注和已有标注框距离相近则不显示自动标注；

2、自动标注需要使用 “./data/mapping.json” 中的映射参数，注意标注参数名（示例中的“a_type”）必须与mapping的映射类型参数名一致，例如：

```
{
	...
	"a_type": {
		class : {...},
		...
	},
	...
}
```

3、如果启用了自动标注，在打开图片的时候会显示自动标注框，可以通过鼠标操作将自动标注框变成真正的标注内容。

### 定义预定义的分类清单

修改 “./data/predefined_classes.txt” 文件即可，每行为一个分类

### 设置多国语言

可在 “./resources/strings” 进行多国语言的配置